local assetHelper = asset.require('util/asset_helper')
local sunTransforms = asset.require('scene/solarsystem/sun/transforms')

asset.require("spice/base")
asset.require('scene/solarsystem/missions/jwst/Lagrange_points')
local transforms = asset.require('scene/solarsystem/missions/jwst/L2')

local JWSTKernel = {
    "C:/Users/ElmQPC/Desktop/Malin/develop/OpenSpace/sync/http/JWST_kernels/1/jwst_horizons_20200101_20240101_v01.bsp"
}

local JWSTPosition = {
    Identifier = "JWSTPosition",
    Parent = transforms.L2.Identifier,
    Transform = {
        Translation = {
            Type = "SpiceTranslation",
            Target = "JWST", 
            Observer = "392", -- L2
            Kernels = JWSTKernel
        },
    },
    GUI = {
        Name = "James Webb Space Telescope Position",
        Path = "/Solar System/Missions/JWST",
        Hidden = true,
    }
}

local JWSTRotation = {
    Identifier = "JWSTRotation",
    Parent = JWSTPosition.Identifier,
    Transform = {
        Rotation = {
            Type = "FixedRotation",
            Attached = "JWSTRotation",
            XAxis = { 1, 0, 0 },
            XAxisOrthogonal = true,
            YAxisInvert = true,
            YAxis = sunTransforms.SolarSystemBarycenter.Identifier
        }
    },
    GUI = {
        Name = "James Webb Space Telescope Rotation",
        Path = "/Solar System/Missions/JWST",
        Hidden = true,
    }
}

local JWSTBand = {
    Identifier = "JWSTBand",
    Parent = JWSTPosition.Identifier,
    Transform = {
        Rotation = {
            Type = "FixedRotation",
            Attached = "JWSTBand",
            XAxis = { 1, 0, 0 },
            XAxisOrthogonal = true,
            ZAxis = sunTransforms.SolarSystemBarycenter.Identifier
        }
    },
    Renderable = {
        Enabled = false,
        Type = "RenderableSphere",
        Texture = "C:/Users/ElmQPC/Desktop/Malin/develop/images/jwst/JWST-band.png",
        Size = 9.2E15,
        Segments = 50,
        DisableFadeInOut = true,
        Orientation = "Inside",
        Opacity = 0.1,
        UseAdditiveBlending = true,
    },
    Tag = { "fov" },
    GUI = {
        Name = "James Webb Space Telescope View Band",
        Path = "/Solar System/Missions/JWST",
        Hidden = true,
    }
}

local JWSTModel = {
    Identifier = "JWSTModel",
    Parent = JWSTRotation.Identifier,
    Transform = {
        Rotation = {
            Type = "StaticRotation",
            Rotation = {
                0, 0, 0
            }
        }
    },
    Renderable = {
        Type = "RenderableModel",
        GeometryFile = "C:/Users/ElmQPC/Desktop/Malin/develop/WIP/data/JWST_model/3/JWSTFBX.fbx",
        ModelScale = "Foot",
        InvertModelScale = true,
        EnableAnimation = true,
        AnimationStartTime = "2021 10 31 00:00:00",
        AnimationMode = "BounceFromStart",
        LightSources = {
            {
                Type = "SceneGraphLightSource",
                Identifier = "Sun",
                Node = sunTransforms.SolarSystemBarycenter.Identifier,
                Intensity = 1.0
            }
        },
        PerformShading = true,
        DisableFaceCulling = true
    },
    GUI = {
        Name = "James Webb Space Telecope",
        Path = "/Solar System/Missions/JWST",
    }
}

local JWSTTrail = {
    Identifier = "JWSTTrail",
    Parent = transforms.L2.Identifier,
    Renderable = {
        Type = "RenderableTrailOrbit",
        Translation = {
            Type = "SpiceTranslation",
            Target = "JWST", 
            Observer = "392", -- L2
            Kernels = JWSTKernel
        },
        Color = { 0.9, 0.9, 0.0 },
		Period = 91.3105,
        Resolution = 100
    },
    GUI = {
        Name = "James Webb Space Telescope Trail",
        Path = "/Solar System/Missions/JWST"
    }
}

local JWSTFov = {
    Identifier = "JWSTFov",
    Parent = JWSTModel.Identifier,
    Renderable = {
        Enabled = false,
        Type = "RenderablePrism",
        Segments = 6,
        Lines = 3,
        Radius = 3.25,
        LineWidth = 1.0,
        Color = {
            1.0, 1.0, 1.0
        },
        Length = 9.2E15
    },
    Transform = {
        Rotation = {
            Type = "StaticRotation",
            Rotation = {
                0, 0, 0.523598776 -- 30 deg around Z-axis in radians
            }
        },
    },
    Tag = { "fov" },
    GUI = {
        Name = "James Webb Space Telecope Field of View",
        Path = "/Solar System/Missions/JWST",
    }
}

assetHelper.registerSceneGraphNodesAndExport(asset, {
	JWSTTrail,
    JWSTPosition,
    JWSTRotation,
    JWSTBand,
    JWSTModel,
    JWSTFov
})
