local assetHelper = asset.require('util/asset_helper')
local sunTransforms = asset.require('scene/solarsystem/sun/transforms')
local transforms = asset.require('scene/solarsystem/planets/earth/transforms')

local transferFunctions = asset.localResource("transferfunctions")
local masVelocityColorTable = transferFunctions .. "/velocity_fieldlines.txt"
local masDensityColorTable = transferFunctions .. "/density_fieldlines.txt"

local fieldlinesDirectory = 'D:/data/bastille_day/mas-filedlines/MAS_BastilleDay_mhd_field_lines/BastilleDay/mhd_field_lines/JSON'


local sunRadius = 6.957E8

-- Fieldlies from binaries
local fieldlines = {
    Identifier = "MAS_MHD_Fieldlines",
    Parent = sunTransforms.HNMReferenceFrame.Identifier,
    -- wrong Parent = sunTransforms.SunIAU.Identifier,
    Renderable = {
        Type = "RenderableFieldlinesSequence",
        SourceFolder = fieldlinesDirectory,
        -- FlowEnabled = false,
        -- LineWidth = 1.0;
        AlphaBlendlingEnabled = false,
        InputFileType = "json",

        ColorTablePaths = {
            masDensityColorTable,
            masVelocityColorTable,
        },
        ColorTableMinMax = {
            { 0, 1000000 },
            { 100, 2000 }
        },
        LoadAtRuntime = true,
        ScaleToMeters = 1.0,
        SecondsBefore = 24*60*60,
        SecondsAfter = 24*60*60,
        SimulationModel = "enlil",
        Color = {
            Uniform = {1.0, 0.0, 0.5, 1}
        }
    },
    GUI = {
        Path = "/Solar System/Heliosphere",
        Name = "MAS Fieldlines"
    },
    Transform = {
        Scale = {
            Type = "StaticScale",
            Scale = sunRadius
        },
--[[	Rotation = {
        --This is a rotation matrix to go from Carrington longitude referens frame to HEEQ180
        --which is what the renderables paretn transforms.HNMReferenceFrame.Identifier is
        --refering to. At the referens time, MAS_seq = 0, 2000-07-14T08:33:37.105 the Carrington
        --longitude was 309.3 degrees.
        --Difference from HEEQ => 360-309.3=50.7 
        --(or 0-309.3 = -309.3 However this leads to the same rotation matrix in the end)
        --Since OpenSpace supports HEEQ180 and not HEEQ, 180 was added or subtracted
        -- => a1 = -129.3 and a2 = 230.7
        --Rotation matrix: (cos a, -sin a, 0)(sin a, cos a, 0)(0, 0, 1) leads to the result.
	    Type = "FixedRotation",
            XAxis = {-0.63338087262755016203262119192353, -0.77384020972650618518999944537717, 0.0},
            YAxis = {0.77384020972650618518999944537717, -0.63338087262755016203262119192353, 0.0},
            ZAxis = {0.0, 0.0, 1.0}
        }
    ]]--
    }
} 

assetHelper.registerSceneGraphNodesAndExport(asset, { fieldlines })

asset.meta = {
    Name = "Json fieldlines files Bastille Day",
    Version = "1.0",
    Description = " Magnetic fieldlines for the bastille day CME event ",
    Author = "OpenSpace team",
    URL = "",
    License = ""
}